...background...
Tried recalibrating the deduped bams, which all failed with a java memory warning. 
Doubled the memory available to 32, 64, and 128G, all of which failed the same way. 
Starting investigating:

Mel_5_Recal_test_01.sh
One sample, restriced to chromosome 20
Failed after 20 minutes several times. "You have not provided enough memory to Java"

Mel_5_Recal_test_01_Jess.sh
One sample from Jess, again restricted to Chr 20. Reference and known sites from hg19. 
It ran fine. 

Mel_5_Recal_test_02_Jess.sh
Second recalibration, also fine

Mel_5_Recal_test_03_Jess.sh
Produced report, fine

Mel_5_Recal_test_04_Jess.sh
Print reads, looks fine. 

Melarray_recal_etc_1 and 2
Realigned and recalibrated an old set of WES files. Worked.

Validate_sam.sh
Uses picardtools validatesamfile to check all the bams. They're all fine. 

Melarray_from_the_top
Just trying the whole pipeline again on the smallest exome files. 
From aligner to fixmate.
With GATK 3.8 instead of 3.7
It worked. 

Recalibrate_3.8.sh
Recal with the new GATK, using files from above. 
It failed as usual. 

GATK_3.8_whole_interval.sh
Same file as above, using whole interval list instead of chromosome 20

GATK_3.8_mitochndria
Same file as above, using just MT 
It worked!

GATK_3.8_small_interval
Same file as above, using a small interval -L 20:1-1000000
It worked!

calc_coverage.sh
On advice from GATK forums, checked the coverage. It might be too high. Used 2 different ways. 
About 1000 intervals over 400x, about 400 intervals over 500x

calc_coverage.sh
Check coverage of the melarray file from above to see if this is the difference. 
Probably not... there are 1000 loci above 500x coverage... however the input files are much smaller

downsamp_400.sh
Try the recalibration again, using parameter -dcov 400 to set max coverage. 
Failed as ususal. 

downsamp_20.sh
As above, but -dcov 20. 
Failed, but with no errors? Did not create recalibration report, but also did not create an error file.

downsamp_5.sh
As above, -dcov 5
Failed as usual. 

exclude_big.sh 
Removed intervals with > 500 coverage anywhere
$ awk '/>500/{print $1}' _coverage_stats.sample_interval_summary > big_intervals.list
Passed these to baserecal using -XL (exclude intervals)
Failed as usual

graph_coverage.R
Plots coverage by chromosome. Found many regions over 5000. 
I'm wondering if the "big" intervals above may have failed to capture small regions
of very high coverage. The interval-level coverage stats are means. 

find_over_coverage.R
Finds individual loci with coverage > 500, makes a bed file. Then a one line bedtools command creates 
intervals from these.

exclude_big_2.sh
BaseRecalibrator excluding big_intervals.list from above, and over_500.bed from R script
Same failure as always

GATK4_exclude_big.sh
Using the new GATK, with 64G, excluding both lists above. 
It worked!!
